import pandas as pd
from pathlib import Path

from matplotlib import pyplot as plt

stats_dir = Path("stats")

RF = "Random Forest"
KNN = "K-Nearest Neighbour"
SVM = "Support Vector Machine"
GB = "Gradient Boosting"


class IndividualScoreStats:
    """
    Manage test scores.
    """
    def __init__(self, file: str) -> None:
        """
        Load or create a new score dataframe.
        """
        self._path: Path = stats_dir.joinpath(file)
        if self._path.exists():
            self.df: pd.DataFrame = pd.read_csv(self._path).set_index("Feature")
        else:
            self.df: pd.DataFrame = pd.DataFrame(columns=["Feature", RF, KNN, SVM, GB, "Dimension"]).set_index("Feature")

    def new_feature(self, name: str, dimension: str | int) -> None:
        self.df.at[name[0], "Dimension"] = dimension

    def update(self, ftr: str, mod: str, score: float) -> None:
        """
        Update a score.

        -- PARAMETERS --
        ftr: A feature name.
        mod: A model name.
        score: A score value.
        """
        self.df.at[ftr[0], mod] = round(score, 4)

    def save(self) -> None:
        """
        Save scores to a `.csv` file.
        """
        self.df.to_csv(self._path)

    def plot(self, feature: str) -> None:
        self.df.loc[feature[0], [RF, KNN, SVM, GB]].plot.bar(title=f"Accuracy of {feature[0]}")
        plt.subplots_adjust(bottom=0.3)
        plt.xticks(rotation=45)
        plt.ylim(0, 1)
        plt.savefig("results/"+feature[0]+"_results.png")



