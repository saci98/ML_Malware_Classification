from pathlib import Path
import pandas as pd
from scipy import sparse

ftr_dir = Path("pre-extract")
data_dir = Path("data")
lbls = pd.read_csv(data_dir.joinpath("trainLabels_malign.csv"))


def integrated_features() -> pd.DataFrame:
    def load_npz(file: str, prefix: str) -> pd.DataFrame:
        df = pd.DataFrame(sparse.load_npz(ftr_dir.joinpath(file)).toarray())
        df["ID"] = lbls.index
        df.set_index("ID", inplace=True)
        df.columns = [f"{prefix}--{str(col)}" for col in df.columns]
        return df

    api_grams = load_npz("api_4grams.npz", "api")
    byte_grams = load_npz("bytes_3grams.npz", "byte")

    dfs = []
    dfs.append(api_grams)
    dfs.append(byte_grams)

    return pd.concat(dfs, axis="columns")

